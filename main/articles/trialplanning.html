<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="simIDM">
<title>Power and Type I Error Calculations • simIDM</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Power and Type I Error Calculations">
<meta property="og:description" content="simIDM">
<meta property="og:image" content="https://insightsengineering.github.io/simIDM/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-125641273-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-125641273-1');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">simIDM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Introduction</h6>
    <a class="dropdown-item" href="../articles/quickstart.html">Getting Started</a>
    <a class="dropdown-item" href="../articles/trialplanning.html">Power and Type I Error Calculations</a>
    <a class="dropdown-item" href="../articles/correlation.html">Correlation between PFS and OS</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Details</h6>
    <a class="dropdown-item" href="../articles/pwc_survival.html">Piecewise Constant Hazards Calculations</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<!-- start dropdown for versions --> <li class="nav-item dropdown">
        <a href="#" class="nav-link dropdown-toggle"
          data-bs-toggle="dropdown" role="button"
          aria-expanded="false" aria-haspopup="true"
          id="dropdown-versions">Versions</a> <div class="dropdown-menu" aria-labelledby="dropdown-versions"> <a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/simIDM/latest-tag">latest-tag</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/simIDM/main">main</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/simIDM/v0.1.0">v0.1.0</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/simIDM/v0.0.5">v0.0.5</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/simIDM/v0.0.4">v0.0.4</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/simIDM/v0.0.2">v0.0.2</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/simIDM/v0.0.1">v0.0.1</a> </div></li>
<!-- end dropdown for versions -->
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-reports">Reports</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-reports">
    <a class="dropdown-item" href="../coverage-report/">Coverage report</a>
    <a class="dropdown-item" href="../unit-test-report/">Unit test report</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/insightsengineering/simIDM">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Power and Type I Error Calculations</h1>
                        <h4 data-toc-skip class="author">Alexandra
Erdmann, Holger Löwe</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/insightsengineering/simIDM/blob/HEAD/vignettes/trialplanning.Rmd" class="external-link"><code>vignettes/trialplanning.Rmd</code></a></small>
      <div class="d-none name"><code>trialplanning.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette demonstrates how to use <code>simIDM</code> for trial
design planning with a simple example. We will show how to estimate type
I errors and statistical power from simulations to optimize study
design, details can be found in <span class="citation">Erdmann,
Beyersmann, and Rufibach (2023)</span>. Jointly modeling the endpoints
PFS and OS with the illness-death model has two major advantages: - We
properly account for the correlation between PFS and OS, - The
assumption of proportional hazards is not required.</p>
<p>OS is defined as the time to reach the absorbing state death, and PFS
is defined as the time to reach the absorbing state <code>death</code>
or the intermediate state <code>progression</code>, whichever occurs
first. Figure 1 shows the multistate model with the corresponding
transition hazards. In the vignette, we show how to estimate type I
errors and statistical power from simulations and give an idea on how
this can be used to plan complex study trials.</p>
<pre><code><span><span class="co">#&gt; Warning in plot.Hist(idHist, stateLabels = stateLabels, box1.row = 2, box1.column = 1, : The dimension of the boxes may depend on the current graphical device</span></span>
<span><span class="co">#&gt; in the sense that the layout and centering of text may change when you resize the graphical device and call the same plot.</span></span></code></pre>
<div class="figure">
<img src="trialplanning_files/figure-html/unnamed-chunk-1-1.png" alt=" Figure 1 - Multistate model with indermediate state progession and absorbing state death" width="60%"><p class="caption">
Figure 1 - Multistate model with indermediate state progession and
absorbing state death
</p>
</div>
</div>
<div class="section level2">
<h2 id="scenario---pfs-and-os-as-co-primary-endpoints">Scenario - PFS and OS as Co-primary Endpoints<a class="anchor" aria-label="anchor" href="#scenario---pfs-and-os-as-co-primary-endpoints"></a>
</h2>
<p>We consider the following study design:</p>
<ul>
<li>PFS and OS as co-primary endpoints with one final analysis each,
i.e. for a successful trial all endpoints need to be significant.</li>
<li>Treatment vs. control group, 1:1 randomization ratio</li>
<li>Global significance level of 5 %</li>
<li>The standard log-rank test is used to assess the null hypothesis of
equal survival functions in both groups for PFS and OS,
respectively.</li>
<li>Statistical power to detect a difference between the groups should
be 80 % for each endpoint</li>
<li>5 % drop-out within 12 time units</li>
<li>Accrual of 100 patients per time unit</li>
</ul>
<p>Using the multistate model approach implies that trial planning is
based on assumptions on the three transition hazards in each arm,
i.e. six hazards in total. In our example scenario, we assume that all
six transition hazards are constant and a small effect of the treatment
on hazards from the initial state to death. Transition hazards are tuned
such that median time until a PFS event is 0.87 time units in the
control arm and 1.2 time units in the treatment arm. Median time until
an OS event is 1.76 time units in the control group and 2.1 time units
in the treatment group.</p>
<p>Figure 2 shows the transition hazards, survival functions, hazard
functions and hazard ratios for both endpoints.</p>
<div class="float">
<img src="scenario.png" alt="Figure 2 - Transition hazards, survival functions, hazard functions and hazard ratios for our scenario."><div class="figcaption">Figure 2 - Transition hazards, survival
functions, hazard functions and hazard ratios for our scenario.</div>
</div>
<p>The transition hazards are specified as follows:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/insightsengineering/simIDM/" class="external-link">simIDM</a></span><span class="op">)</span></span>
<span><span class="va">transitionTrt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/exponential_transition.html">exponential_transition</a></span><span class="op">(</span>h01 <span class="op">=</span> <span class="fl">0.3</span>, h02 <span class="op">=</span> <span class="fl">0.28</span>, h12 <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">transitionPl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/exponential_transition.html">exponential_transition</a></span><span class="op">(</span>h01 <span class="op">=</span> <span class="fl">0.5</span>, h02 <span class="op">=</span> <span class="fl">0.3</span>, h12 <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></span>
<span></span>
<span><span class="va">transitionList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">transitionPl</span>, <span class="va">transitionTrt</span><span class="op">)</span></span></code></pre></div>
<p>The package provides functions that return the values of the PFS or
OS survival functions for given transition hazards (Constant, Weibull or
Piecewise Constant) and pre-specified time points.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">timepoints</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0.3</span>, <span class="fl">0.7</span>, <span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co"># OS Survival function for Constant transition hazards:</span></span>
<span><span class="fu"><a href="../reference/ExpSurvOS.html">ExpSurvOS</a></span><span class="op">(</span><span class="va">timepoints</span>, h01 <span class="op">=</span> <span class="fl">0.2</span>, h02 <span class="op">=</span> <span class="fl">0.4</span>, h12 <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.0000000 0.9610787 0.8893403 0.7671856 0.6912219 0.2724845</span></span>
<span><span class="co"># OS Survival function for Weibull transition hazards:</span></span>
<span><span class="fu"><a href="../reference/WeibSurvOS.html">WeibSurvOS</a></span><span class="op">(</span><span class="va">timepoints</span>, h01 <span class="op">=</span> <span class="fl">0.2</span>, h02 <span class="op">=</span> <span class="fl">0.5</span>, h12 <span class="op">=</span> <span class="fl">2.1</span>, p01 <span class="op">=</span> <span class="fl">1.2</span>, p02 <span class="op">=</span> <span class="fl">0.9</span>, p12 <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.00000000 0.93822237 0.83706585 0.66353708 0.55296799 0.03684786</span></span>
<span><span class="co"># OS Survival function for Piecewise Constant transition hazards:</span></span>
<span><span class="fu"><a href="../reference/PWCsurvOS.html">PWCsurvOS</a></span><span class="op">(</span><span class="va">timepoints</span>,</span>
<span>  h01 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.5</span><span class="op">)</span>, h02 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.8</span><span class="op">)</span>, h12 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  pw01 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span>, pw02 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">8</span><span class="op">)</span>, pw12 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.00000000 0.95094877 0.85849702 0.69546105 0.59109798 0.03945673</span></span></code></pre></div>
<p>There are also functions for PFS survival functions available:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">timepoints</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0.3</span>, <span class="fl">0.7</span>, <span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co"># PFS Survival function for Constant transition hazards:</span></span>
<span><span class="fu"><a href="../reference/ExpSurvPFS.html">ExpSurvPFS</a></span><span class="op">(</span><span class="va">timepoints</span>, h01 <span class="op">=</span> <span class="fl">0.2</span>, h02 <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.00000000 0.94176453 0.83527021 0.65704682 0.54881164 0.04978707</span></span>
<span><span class="co"># PFS Survival function for Weibull transition hazards:</span></span>
<span><span class="fu"><a href="../reference/WeibSurvPFS.html">WeibSurvPFS</a></span><span class="op">(</span><span class="va">timepoints</span>, h01 <span class="op">=</span> <span class="fl">0.2</span>, h02 <span class="op">=</span> <span class="fl">0.5</span>, p01 <span class="op">=</span> <span class="fl">1.2</span>, p02 <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.00000000 0.92721907 0.80545180 0.61074857 0.49658530 0.02995439</span></span>
<span><span class="co"># PFS Survival function for Piecewise Constant transition hazards:</span></span>
<span><span class="fu"><a href="../reference/PWCsurvPFS.html">PWCsurvPFS</a></span><span class="op">(</span><span class="va">timepoints</span>,</span>
<span>  h01 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.5</span><span class="op">)</span>, h02 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.8</span><span class="op">)</span>,</span>
<span>  pw01 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span><span class="op">)</span>, pw02 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">8</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.00000000 0.92311635 0.78662786 0.57120906 0.44932896 0.01499558</span></span></code></pre></div>
<p>For PFS, the hazard ratio under <span class="math inline">\(H_0\)</span> is known by specification:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hTrtPFS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">transitionTrt</span><span class="op">$</span><span class="va">hazards</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">hPlPFS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">transitionPl</span><span class="op">$</span><span class="va">hazards</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">hRatioPFS</span> <span class="op">&lt;-</span> <span class="va">hTrtPFS</span> <span class="op">/</span> <span class="va">hPlPFS</span></span>
<span><span class="va">hRatioPFS</span></span>
<span><span class="co">#&gt; [1] 0.725</span></span></code></pre></div>
<p>For OS, the ratio of hazard functions is not necessarily constant. An
averaged HR can be calculated using <code>avgHRExpOS</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hRatioOS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/avgHRExpOS.html">avgHRExpOS</a></span><span class="op">(</span>transitionByArm <span class="op">=</span> <span class="va">transitionList</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, upper <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">hRatioOS</span></span>
<span><span class="co">#&gt; [1] 0.8072368</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="type-i-error---simulation-under-h_0">Type I Error - Simulation Under <span class="math inline">\(H_0\)</span><a class="anchor" aria-label="anchor" href="#type-i-error---simulation-under-h_0"></a>
</h2>
<p>The type I error can be estimated empirically by simulating clinical
trials under <span class="math inline">\(H_0\)</span>. To achieve this,
we set the transition hazards of the treatment group to match those of
the control group. Then, we use <code><a href="../reference/getClinicalTrials.html">getClinicalTrials()</a></code> to
generate a large number of simulated trials. We will use 100 iterations
here. For applications, to achieve satisfactory precision in estimates
of type I error, a higher number (e.g. 10,000) is recommended.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">transitionListNull</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">transitionPl</span>, <span class="va">transitionPl</span><span class="op">)</span></span>
<span><span class="va">nRep</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">simNull</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getClinicalTrials.html">getClinicalTrials</a></span><span class="op">(</span></span>
<span>  nRep <span class="op">=</span> <span class="va">nRep</span>, nPat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">800</span>, <span class="fl">800</span><span class="op">)</span>, seed <span class="op">=</span> <span class="fl">1238</span>, datType <span class="op">=</span> <span class="st">"1rowPatient"</span>,</span>
<span>  transitionByArm <span class="op">=</span> <span class="va">transitionListNull</span>,</span>
<span>  dropout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fl">0.05</span>, time <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>, accrual <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>param <span class="op">=</span> <span class="st">"intensity"</span>, value <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Using the simulation, we can now identify critical log-rank test
values for both PFS and OS to maintain a 5% global significance level.
Initially, we allocate critical values so that the two-sided log-rank
test has a 4% significance level for the OS endpoint and 1% for the PFS
endpoint, effectively splitting the global significance level. Such a
Bonferroni correction is widely used in trials with co-primary
endpoints.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">alphaOS</span> <span class="op">&lt;-</span> <span class="fl">0.04</span></span>
<span><span class="va">alphaPFS</span> <span class="op">&lt;-</span> <span class="fl">0.01</span></span>
<span><span class="va">criticalOS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">alphaOS</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">criticalPFS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="va">alphaPFS</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>With the Schoenfeld approximation, preliminary sample sizes can be
computed to get an idea of how many events are needed to achieve 80 %
power:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.rpact.org" class="external-link">rpact</a></span><span class="op">)</span></span>
<span><span class="co"># Number of PFS events required for 80 % power via Schoenfeld:</span></span>
<span><span class="va">schoenfeldPFS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rpact-com.github.io/rpact/reference/getSampleSizeSurvival.html" class="external-link">getSampleSizeSurvival</a></span><span class="op">(</span></span>
<span>  lambda2 <span class="op">=</span> <span class="va">hPlPFS</span>, hazardRatio <span class="op">=</span> <span class="va">hRatioPFS</span>,</span>
<span>  accrualTime <span class="op">=</span> <span class="fl">0</span>, accrualIntensity <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  maxNumberOfSubjects <span class="op">=</span> <span class="fl">1000</span>, sided <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  alpha <span class="op">=</span> <span class="va">alphaPFS</span> <span class="op">/</span> <span class="fl">2</span>, beta <span class="op">=</span> <span class="fl">0.2</span></span>
<span><span class="op">)</span></span>
<span><span class="va">eventNumPFS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">schoenfeldPFS</span><span class="op">$</span><span class="va">eventsFixed</span><span class="op">)</span></span>
<span><span class="va">eventNumPFS</span></span>
<span><span class="co">#&gt; [1] 452</span></span>
<span></span>
<span><span class="co"># Number of OS events required for 80 % power via Schoenfeld:</span></span>
<span><span class="va">schoenfeldOS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rpact-com.github.io/rpact/reference/getSampleSizeSurvival.html" class="external-link">getSampleSizeSurvival</a></span><span class="op">(</span></span>
<span>  lambda2 <span class="op">=</span> <span class="va">hPlPFS</span>, hazardRatio <span class="op">=</span> <span class="va">hRatioOS</span>,</span>
<span>  accrualTime <span class="op">=</span> <span class="fl">0</span>, accrualIntensity <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  maxNumberOfSubjects <span class="op">=</span> <span class="fl">1000</span>, sided <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  alpha <span class="op">=</span> <span class="va">alphaOS</span> <span class="op">/</span> <span class="fl">2</span>, beta <span class="op">=</span> <span class="fl">0.2</span></span>
<span><span class="op">)</span></span>
<span><span class="va">eventNumOS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">ceiling</a></span><span class="op">(</span><span class="va">schoenfeldOS</span><span class="op">$</span><span class="va">eventsFixed</span><span class="op">)</span></span>
<span><span class="va">eventNumOS</span></span>
<span><span class="co">#&gt; [1] 732</span></span></code></pre></div>
<p>Using these critical values and required number of events for PFS and
OS, we can now determine the global type I error empirically by counting
the number of trials simulated under <span class="math inline">\(H_0\)</span> with significant log-rank tests. The
empirical type I error for each endpoint is calculated as the proportion
of trials with significant log-rank tests, while the global Type I error
is the proportion of trials where at least one of PFS or OS with a
significant log-rank test. This can be done using
<code>empSignificant</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/empSignificant.html">empSignificant</a></span><span class="op">(</span></span>
<span>  simTrials <span class="op">=</span> <span class="va">simNull</span>,</span>
<span>  criticalPFS <span class="op">=</span> <span class="va">criticalPFS</span>,</span>
<span>  criticalOS <span class="op">=</span> <span class="va">criticalOS</span>,</span>
<span>  eventNumPFS <span class="op">=</span> <span class="va">eventNumPFS</span>,</span>
<span>  eventNumOS <span class="op">=</span> <span class="va">eventNumOS</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; $significantPFS</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $significantOS</span></span>
<span><span class="co">#&gt; [1] 0.03</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $significantAtLeastOne</span></span>
<span><span class="co">#&gt; [1] 0.03</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $significantBoth</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
<p>In this example, the global type I error rate is 3%.</p>
</div>
<div class="section level2">
<h2 id="sample-size-and-power-calculation---simulation-under-h_1">Sample size and power calculation - simulation under <span class="math inline">\(H_1\)</span><a class="anchor" aria-label="anchor" href="#sample-size-and-power-calculation---simulation-under-h_1"></a>
</h2>
<p>Next, we simulate a large number of trials under <span class="math inline">\(H_1\)</span> to compute the empirical power:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simH1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getClinicalTrials.html">getClinicalTrials</a></span><span class="op">(</span></span>
<span>  nRep <span class="op">=</span> <span class="va">nRep</span>, nPat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">800</span>, <span class="fl">800</span><span class="op">)</span>, seed <span class="op">=</span> <span class="fl">1238</span>, datType <span class="op">=</span> <span class="st">"1rowPatient"</span>,</span>
<span>  transitionByArm <span class="op">=</span> <span class="va">transitionList</span>,</span>
<span>  dropout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>rate <span class="op">=</span> <span class="fl">0.05</span>, time <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>, accrual <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>param <span class="op">=</span> <span class="st">"intensity"</span>, value <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The empirical power for each endpoint is the proportion of simulated
trials with significant log-rank tests under <span class="math inline">\(H_1\)</span>. The multistate model approach allows
us to easily estimate further interesting metrics, such as joint power,
i.e. the probability that both endpoints in a trial are significant, if
each endpoint is analyzed at its planned time-point.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/empSignificant.html">empSignificant</a></span><span class="op">(</span></span>
<span>  simTrials <span class="op">=</span> <span class="va">simH1</span>,</span>
<span>  criticalPFS <span class="op">=</span> <span class="va">criticalPFS</span>,</span>
<span>  criticalOS <span class="op">=</span> <span class="va">criticalOS</span>,</span>
<span>  eventNumPFS <span class="op">=</span> <span class="va">eventNumPFS</span>,</span>
<span>  eventNumOS <span class="op">=</span> <span class="va">eventNumOS</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; $significantPFS</span></span>
<span><span class="co">#&gt; [1] 0.83</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $significantOS</span></span>
<span><span class="co">#&gt; [1] 0.75</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $significantAtLeastOne</span></span>
<span><span class="co">#&gt; [1] 0.9</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $significantBoth</span></span>
<span><span class="co">#&gt; [1] 0.68</span></span></code></pre></div>
<p>In this example, for the endpoint OS, the number of events has to be
increased to obtain a power of 80 %. Similarly, we can reduce the number
of events if the simulation shows that a trial design appears to be
overpowered.</p>
<p>It is also possible to derive the median time at which a certain
number of events are expected to occur and how many events of the second
endpoint have occurred at that time on average.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># median time point for 329 PFS events to have occurred:</span></span>
<span><span class="va">timePointsPFS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">simH1</span>, <span class="va">getTimePoint</span>,</span>
<span>  eventNum <span class="op">=</span> <span class="fl">329</span>, typeEvent <span class="op">=</span> <span class="st">"PFS"</span>,</span>
<span>  byArm <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">timePointsPFS</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2.912601</span></span>
<span></span>
<span><span class="co"># median time point for 684 OS events to have occurred:</span></span>
<span><span class="va">timePointsOS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">simH1</span>, <span class="va">getTimePoint</span>,</span>
<span>  eventNum <span class="op">=</span> <span class="fl">684</span>, typeEvent <span class="op">=</span> <span class="st">"OS"</span>,</span>
<span>  byArm <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">timePointsOS</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 5.804041</span></span>
<span></span>
<span><span class="co"># mean number of PFS events at time of OS analysis</span></span>
<span><span class="va">eventsPFS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">timePointsPFS</span><span class="op">)</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">simH1</span><span class="op">[[</span><span class="va">t</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">OSevent</span><span class="op">[</span><span class="op">(</span><span class="va">simH1</span><span class="op">[[</span><span class="va">t</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">OStime</span> <span class="op">+</span> <span class="va">simH1</span><span class="op">[[</span><span class="va">t</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">recruitTime</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">timePointsPFS</span><span class="op">[[</span><span class="va">t</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">eventsPFS</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 219.31</span></span>
<span></span>
<span><span class="co"># mean number of OS events at time of PFS analysis</span></span>
<span><span class="va">eventsOS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">timePointsOS</span><span class="op">)</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">simH1</span><span class="op">[[</span><span class="va">t</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">PFSevent</span><span class="op">[</span><span class="op">(</span><span class="va">simH1</span><span class="op">[[</span><span class="va">t</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">PFStime</span> <span class="op">+</span> <span class="va">simH1</span><span class="op">[[</span><span class="va">t</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">recruitTime</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">timePointsOS</span><span class="op">[[</span><span class="va">t</span><span class="op">]</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">eventsOS</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 864.08</span></span></code></pre></div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-erdmann2023" class="csl-entry">
Erdmann, Alexandra, Jan Beyersmann, and Kaspar Rufibach. 2023.
<span>“Oncology Clinical Trial Design Planning Based on a Multistate
Model That Jointly Models Progression-Free and Overall Survival
Endpoints.”</span> <em>arXiv Preprint arXiv:2301.10059</em>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Alexandra Erdmann, Kaspar Rufibach, Holger Löwe, Daniel Sabanés Bové, F. Hoffmann-La Roche AG, University of Ulm.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
